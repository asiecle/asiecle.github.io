<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Puntos - Triatlón</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: url("pista_roja.jpeg") no-repeat center center/cover;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        .container {
            background: rgba(0, 0, 0, 0.7);
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.3);
        }
        .container-prin {
            background: rgba(0, 0, 0, 0.7);
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 8px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.3);
        }
        h2, h3 {
            color: #ffcc00;
        }
        h4 {
            color: #ffcc00;
            font-style: italic;
            line-height: 5px;
            font-size: 10px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-size: 18px;
        }
        input {
            font-size: 18px;
            text-align: center;
            padding: 5px;
            margin-top: 5px;
            border-radius: 5px;
            border: none;
            width: 90px;
        }
        #marca3 {
            width: 100px;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background: #ffcc00;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #000;
            font-weight: bold;
        }
        button:hover {
            background: #ffaa00;
        }
        p {
            font-size: 20px;
            font-weight: bold;
            margin: 5px 0;
        }
        .resultado {
            color: #ffcc00;
        }
        .input-container {
            position: relative;
            display: inline-block;
        }
        .clear-btn {
            position: absolute;
            right: -20px;
            top: 5%;
            transform: translateY(-50%);
            background: red;
            color: white;
            border: none;
            border-radius: 10%;
            width: 20px;
            height: 20px;
            font-size: 9px;
            cursor: pointer;
            line-height: 1px;
            text-align: center;
            padding:0;
        }
        .destacada {
            color: lime;  /* Cambia el color de la "A" */
            font-weight: bold; /* Pone la "A" en negrita */
        }
    </style>
</head>
<body>
    <div class="container-prin">
        <h2>CALCULADORA DE PUNTOS</h2>
    </div>
    <div class="container">
        
        <h2>Triatlón <span class="destacada">A</span> Sub14 Femenino </h2>

        <h3>Introduce las marcas:</h3>
        
       

        <label>80m (ss,cc):</label>
            <div class="input-container">
                <input type="text" id="marca80" placeholder="Ej: 10,75" onfocus="this.select()" onblur="mostrarPuntos('marca80', 'resultado80', datos80)">
                <button class="clear-btn" onclick="clearInput('marca80', 'resultado80')">×</button>
            </div>
        <p id="resultado80" class="resultado"></p>

        <label>80mv (ss,cc):</label>
            <div class="input-container">
                <input type="text" id="marca80v" placeholder="Ej: 12,75" onfocus="this.select()" onblur="mostrarPuntos('marca80v', 'resultado80v', datos80v)">
                <button class="clear-btn" onclick="clearInput('marca80v', 'resultado80v')">×</button>
            </div>
        <p id="resultado80v" class="resultado"></p>
        
        <label>Peso (metros):</label>
            <div class="input-container">
                <input type="text" id="marcaPeso" placeholder="Ej: 4,75" onfocus="this.select()" onblur="mostrarPuntos('marcaPeso', 'resultadoPeso', datosPeso)">
                <button class="clear-btn" onclick="clearInput('marcaPeso', 'resultadoPeso', 'resultadoTotalA')">×</button>
            </div>
        <p id="resultadoPeso" class="resultado"></p>

        <button onclick="calcularPuntos(datos80, datos80v, datosPeso, 'marca80', 'marca80v', 'marcaPeso', 'resultadoTotalA')">Calcular Total</button>
        
        <p id="resultadoTotalA" class="resultado"></p>
        <p></p>
        <p> ______________________ </p>
        <h4>Marca de corte Andalucía (mayo 2024): 946</h4>
        <h4>Marca de corte Andalucía (octubre 2024): 1042</h4>
    </div>
    
    <div class="container">
        <h2>CALCULADORA DE PUNTOS</h2>
        <h2>Triatlón <span class="destacada">B</span> Sub14 Femenino </h2>

        <h3>Introduce las marcas:</h3>
        
        <label>1000m (mm:ss.cc):</label>
            <div class="input-container">
                <input type="text" id="marca1000" placeholder="Ej: 03:15.25" pattern="\\d{2}:\\d{2}\\.\\d{2}" title="Formato: mm:ss.cc" onfocus="this.select()" onblur="mostrarPuntos('marca1000', 'resultado1000', datos1000)">
                <button class="clear-btn" onclick="clearInput('marca1000', 'resultado1000')">×</button>
            </div>
        <p id="resultado1000" class="resultado"></p>

        <label>Longitud (metros):</label>
            <div class="input-container">
                <input type="text" id="marcaLongitud" placeholder="Ej: 8,75" onfocus="this.select()" onblur="mostrarPuntos('marcaLongitud', 'resultadoLongitud', datosLongitud)">
                <button class="clear-btn" onclick="clearInput('marcaLongitud', 'resultadoLongitud', 'resultadoTotalB')">×</button>
            </div>
        <p id="resultadoLongitud" class="resultado"></p>

        <label>Jabalina (metros):</label>
            <div class="input-container">
                <input type="text" id="marcaJabalina" placeholder="Ej: 10,75" onfocus="this.select()" onblur="mostrarPuntos('marcaJabalina', 'resultadoJabalina', datosJabalina)">
                <button class="clear-btn" onclick="clearInput('marcaJabalina', 'resultadoJabalina')">×</button>
            </div>
        <p id="resultadoJabalina" class="resultado"></p>

        <button onclick="calcularPuntos(datos1000, datosLongitud, datosJabalina, 'marca1000', 'marcaLongitud', 'marcaJabalina', 'resultadoTotalB')">Calcular Total</button>
        
        <p id="resultadoTotalB" class="resultado"></p>
        <p></p>
        <p> ______________________ </p>
        <h4>Marca de corte Andalucía (mayo 2024): 824</h4>
        <h4>Marca de corte Andalucía (octubre 2024): 812</h4>
    </div>

    <script>
        // Triatlon A
        let datos80 = [];
        let datos80v = [];
        let datosPeso = [];
        
        // Triatlon B
        let datosLongitud = [];
        let datosJabalina = [];
        let datos1000 = [];
        

        function cargarCSV(url, callback) {
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`No se pudo cargar ${url}`);
                    return response.text();
                })
                .then(texto => {
                    let datos = texto.split("\n").map(fila => fila.split(";")).slice(1);
                    datos = datos.map(fila => [
                        convertirFormato(fila[0]),
                        parseInt(fila[1])
                    ]);
                    callback(datos);
                })
                .catch(error => alert(error.message));
        }
        
        function clearInput(inputId, resultadoId, resultadoTotalId) {
            const input = document.getElementById(inputId);
            const inputResultado = document.getElementById(resultadoId);
            const inputResultadoTotal = document.getElementById(resultadoTotalId);
            inputResultado.innerText = '' // Oculta el resultado de puntos
            inputResultadoTotal.innerText = '' // Oculta el resultado de puntos total
            input.value = '';  // Borra el contenido
            input.focus();      // Coloca el cursor en el input
        }
        
        function convertirFormato(valor) {
            if (valor.includes(":")) {
                let partes = valor.split(":");
                let minutos = parseInt(partes[0]);
                let segundos = parseFloat(partes[1].replace(",", "."));
                return minutos * 60 + segundos;
            } else {
                return parseFloat(valor.replace(",", "."));
            }
        }

        cargarCSV("80Fem.csv", datos => datos80 = datos);
        cargarCSV("80vFem.csv", datos => datos80v = datos);
        cargarCSV("PesoFem.csv", datos => datosPeso = datos);
        
        cargarCSV("LongitudFem.csv", datos => datosLongitud = datos);
        cargarCSV("JabalinaFem.csv", datos => datosJabalina = datos);
        cargarCSV("1000Fem.csv", datos => datos1000 = datos);

        function buscarPuntos(marca, datos) {
            if (datos.length === 0) {
                alert("Los datos aún no han sido cargados. Inténtalo de nuevo.");
                return null;
            }

            let marcaNum = convertirFormato(marca);
            let marcaMasCercana = datos.reduce((a, b) => 
                Math.abs(b[0] - marcaNum) < Math.abs(a[0] - marcaNum) ? b : a
            );

            if (!marcaMasCercana) {
                alert("La marca introducida no se encuentra en el archivo.");
                return null;
            }

            return marcaMasCercana[1]; 
        }

        function mostrarPuntos(inputId, resultadoId, datos) {
            let marca = document.getElementById(inputId).value.trim();
            if (!marca) {
                document.getElementById(resultadoId).innerText = "";
                return;
            }

            let puntos = buscarPuntos(marca, datos);
            if (puntos !== null) {
                document.getElementById(resultadoId).innerText = `Puntos: ${puntos}`;
            }
        }

        function calcularPuntos(datos1, datos2, datos3, marca1id, marca2id, marca3id, resultadoTotalid) {
            if (datos1.length === 0 || datos2.length === 0 || datos3.length === 0) {
                alert("Los archivos CSV aún no han sido cargados.");
                return;
            }

            let marca1 = document.getElementById(marca1id).value.trim();
            let marca2 = document.getElementById(marca2id).value.trim();
            let marca3 = document.getElementById(marca3id).value.trim();

            if (!marca1 || !marca2 || !marca3) {
                alert("Introduce las tres marcas.");
                return;
            }

            let puntos1 = buscarPuntos(marca1, datos1);
            let puntos2 = buscarPuntos(marca2, datos2);
            let puntos3 = buscarPuntos(marca3, datos3);

            if (puntos1 === null || puntos2 === null || puntos3 === null) {
                return;
            }

            let puntosTotales = puntos1 + puntos2 + puntos3;

            document.getElementById(resultadoTotalid).innerText = `Puntos Totales: ${puntosTotales}`;
        }
    </script>
</body>
</html>
